-- GENERAR EL DDL

DROP DATABASE IF EXISTS proyecto_reservas_pilates ; -- reserv_ar

CREATE DATABASE proyecto_reservas_pilates;

USE proyecto_reservas_pilates;

-- Tabla RESERVA
CREATE TABLE RESERVA (
    IDRESERVA INT PRIMARY KEY AUTO_INCREMENT,
    IDALUMNO INT,
    IDEQUIPO INT,
    IDPROFESOR INT,
    IDTIPORESERVA INT,
    IDTIPOCLASE INT,
    IDNIVELCLASE INT,
    FECHA DATETIME,
    HORA TIME,
    CANCELACION DATETIME DEFAULT NULL
);

-- Tabla ALUMNO
CREATE TABLE ALUMNO (
    IDALUMNO INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR(100) DEFAULT 'USUARIO_UNKNOW',
    TELEFONO VARCHAR(20) NOT NULL,
    NACIMIENTO DATE(20) NOT NULL,
    CORREO VARCHAR(100) UNIQUE NOT NULL
);

-- Tabla PROFESOR
CREATE TABLE PROFESOR (
    IDPROFESOR INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR(100),
    TELEFONO VARCHAR(20),
    CORREO VARCHAR(100),
    IDTIPOCLASE INT
);

-- Tabla TIPOCLASE
CREATE TABLE TIPOCLASE (
    IDTIPOCLASE INT PRIMARY KEY AUTO_INCREMENT,
    IDPROFESOR INT PRIMARY KEY AUTO_INCREMENT,
    FECHA DATETIME(20),
    HORA TIME(20)
);

-- Tabla TIPORESERVA
CREATE TABLE TIPORESERVA (
    IDTIPORESERVA INT PRIMARY KEY AUTO_INCREMENT,
    TIPO VARCHAR(50)
);

-- Tabla NIVELCLASE
CREATE TABLE NIVELCLASE (
    IDNIVELCLASE INT PRIMARY KEY AUTO_INCREMENT,
    IDPROFESOR INT PRIMARY KEY AUTO_INCREMENT,
    IDTIPOCLASE INT PRIMARY KEY AUTO_INCREMENT,
    FECHA DATETIME(20),
    HORA TIME(20)
);

-- Tabla EQUIPO
CREATE TABLE EQUIPO (
    IDEQUIPO INT PRIMARY KEY AUTO_INCREMENT,
    IDPROFESOR INT,
    CAPACIDAD INT,
    DISPONIBLE BOOLEAN
);



-- FOREIGN KEYS DEFINITION

-- PROFESOR

ALTER TABLE PROFESOR
    ADD CONSTRAINT FK_EMP_ALUMNO
    FOREIGN KEY (IDTIPORESERVA) REFERENCES TIPORESERVA (IDTIPORESERVA);
    
-- EQUIPO
ALTER TABLE EQUIPO
    ADD CONSTRAINT FK_EQUIPO_TIPORESERVA
    FOREIGN KEY (IDTIPORESERVA) REFERENCES RESTAURANTE(IDTIPORESERVA);
    
-- RESERVAS

ALTER TABLE RESERVA
    ADD CONSTRAINT FK_RESERVA_ALUMNO
    FOREIGN KEY (IDALUMNO) REFERENCES ALUMNO(IDALUMNO);

ALTER TABLE RESERVA
    ADD CONSTRAINT FK_RESERVA_EQUIPO
    FOREIGN KEY (IDEQUIPO) REFERENCES EQUIPO(IDEQUIPO);

ALTER TABLE RESERVA
    ADD CONSTRAINT FK_RESERVA_PROFESOR
    FOREIGN KEY (IDPROFESOR) REFERENCES PROFESOR(IDPROFESOR);
    
ALTER TABLE RESERVA
    ADD CONSTRAINT FK_RESERVA_TIPORESERVA
    FOREIGN KEY (IDTIPORESERVA) REFERENCES TIPORESERVA(IDTIPORESERVA);
    
ALTER TABLE RESERVA
    ADD CONSTRAINT FK_RESERVA_TIPOCLASE
    FOREIGN KEY (IDTIPOCLASE) REFERENCES TIPOCLASE(IDTIPOCLASE);    
   
   ALTER TABLE RESERVA
    ADD CONSTRAINT FK_RESERVA_NIVELCLASE
    FOREIGN KEY (IDNIVELCLASE) REFERENCES NIVELCLASE(IDNIVELCLASE); 
    